<!--
jsNotebook 0-install boot loader:
Include or copy+paste this file into your jsNotebook file.
-->
<noscript>ERROR: This jsNotebook can't be displayed unless JavaScript is enabled.</noscript>
<style>
body /*tty (green screen) style*/
{
  font-family: "Courier New", Courier, monospace;
  font-size: 12px;
  white-space: pre-line;
  background-color: #333;
  color: #0c0;
  overflow: hidden auto; /*vertical scroll only if needed; no horizontal scroll*/
  min-height: 100%; /*fill entire window; CAUTION: parent height can't be "auto"*/
  margin: 0;
}
noscript /*error message style*/
{
  font-weight: bold;
  font-size: 18px;
  background-color: #300;
  color: #f00;
  border-color: #f00;
  border: 2px solid;
  border-radius: 8px;
  padding: 6px 12px;
  margin: 6px 12px;
  position: fixed; /*overlay previous content, no real estate*/
  top: 10%;
}
DUNNO-html
{
  height: 100%; /*kludge: body needs to know parent's height*/
}
</style>
<script>
const VER = "0.20.7"; //can be used for backwards compatibility
//const CDN = "https://raw.githubusercontent.com/djulien/jsNotebook/master/NOTEBOOKs/SelfContained"; //default location of external files
const CDN = "http://localhost:3000/SelfContained"; //default location of external files
const isready = new Promise((resolve, reject) =>
{
//load external files:
//CORS prevents auto-loading via HTML tags in local file; use fetch() instead
  [
     {
        type: 'text/javascript',
        tag: "script.src",
        path: "/js/jsNotebook.js",
     },
     {
        rel: 'stylesheet',
        tag: "link.href",
        path: "/css/jsNotebook.css",
        notify: true,
     },
   ].forEach(({path, tag, type, rel, notify}) =>
   {
      const what = rel || type || "JUNK"; //avoid undefined attr
      const [name, attr] = tag.split(".");
      const is_loaded = Array.from(document.getElementsByTagName(name)).some((dom_elt) => dom_elt[attr].endsWith(path));
console.log(`checking for ${name}:`, JSON.stringify(path), "is loaded?", is_loaded);
      if (is_loaded && notify) resolve(what + " already loaded");
      if (is_loaded) return; //continue
      fetch(CDN + path) //, {mode: 'no-cors'})
        .then((resp) =>
        {
          if (!resp.ok) throw new Error(`bad response: ${resp.statusText}`); //console.log("bad response:", resp.statusText);
          return resp.text(); //unparsed text stream
        })
        .then((contents) =>
        {
console.log("got " + contents.length + ":", JSON.stringify(contents.slice(0, 30)), "...", JSON.stringify(contents.slice(-30)));
          const newtag = Object.assign(document.createElement(name),
          {
              [what]: what, //rel || type,
//        [attr]: CDN + path,
              innerHTML: contents,
          });
//DON'T NEED: <img> trick adapted from https://www.viget.com/articles/js-201-run-a-function-when-a-stylesheet-finishes-loading/
//          if (notify) newtag.onerror = () =>
//          {
//            document.body.remove(newtag); //no further use for <img>
//            resolve(what + " loaded");
//          };
          document.getElementsByTagName('head')[0].appendChild(newtag);
console.log(name, what + " added");
          resolve(what + " loaded");
        })
        .catch((err) =>
        {
console.log(`Fetch ${CDN + path} failed:`, err);
          reject(Error(what + " failed to load: " + err));
        });
   });
});
</script>
